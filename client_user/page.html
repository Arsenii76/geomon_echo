<!DOCTYPE html>
<html>
<head>
	<title>Регистрация заявки</title>
    <meta charset="utf-8" />
</head>
<body>
	<h1>Служба технической поддержки</h1>
    <h2>Введите данные</h2>
    <form name="registerForm">
        <label>Имя</label><br>
        <input type="text" name="fUserName" />
		<br><br>
        <label>Фамилия</label><br>
        <input type="text" name="sUserName" />
		<br><br>
        <label>Отчество</label><br>
        <input type="text" name="tUserName" />
		<br><br>
		<label>Номер телефона</label><br>
        <input type="text" name="phone" />
		<br><br>
		<label>Коротко о проблеме</label><br>
        <input type="text" name="issue" />
		<br><br>
        <input type="submit" id="submitReg" value="Отправить" />
		<br><br>
    </form>
	<br><br>
	<input type="submit" id="submitGet" value="Получить список всех запросов" />
	<table id="tbl">
		<thead id="tblhd">
		</thead>
		<tbody id="tblbd">
		</tbody>
	</table>
    <script>
		// Initialize and add the map
		function initMap() {
		  // The location of Uluru
		  const uluru = { lat: -25.344, lng: 131.036 };
		  // The map, centered at Uluru
		  const map = new google.maps.Map(document.getElementById("map"), {
			zoom: 4,
			center: uluru,
		  });
		  // The marker, positioned at Uluru
		  const marker = new google.maps.Marker({
			position: uluru,
			map: map,
		  });
		}
		/*
        document.getElementById("submitReg").addEventListener("click",
		function(e) {
            e.preventDefault();
            // получаем данные формы:
            let registerForm = document.forms["registerForm"];
            let fUserName = registerForm.elements["fUserName"].value;
            let sUserName = registerForm.elements["sUserName"].value;
            let tUserName = registerForm.elements["tUserName"].value;
            let phone = registerForm.elements["phone"].value;
            let issue = registerForm.elements["issue"].value;
            // сериализуем данные в json:
            let userIssue = JSON.stringify({fUserName: fUserName, sUserName: sUserName,
											tUserName: tUserName, phone: phone,
											issue: issue});
            let request = new XMLHttpRequest();
            // посылаем запрос на адрес "/registerIssue":
            request.open("POST", "/registerIssue", true);
            request.setRequestHeader("Content-Type", "application/json");
            request.addEventListener("load",
			function() {
				console.log("all right");
            });
            request.send(userIssue);
        });
		//
		document.getElementById("submitGet").addEventListener("click",
		function(e) {
            e.preventDefault();
            let request = new XMLHttpRequest();
            // посылаем запрос на адрес "/getAllIssues":
            request.open("POST", "/getAllIssues", true);
            request.setRequestHeader("Content-Type", "application/json");
            request.addEventListener("load",
			function() {
				// получаем ответ сервера:
                let received = JSON.parse(request.response);
				// table:
				let tbl = document.getElementById("tbl");
				// head:
                let tblhd = document.getElementById("tblhd");
				if(!(tblhd.lastChild.id === "tbltr")) {
					let trh = document.createElement("tr");
					trh.setAttribute("id", "tbltr");
					trh.innerHTML = "<td>Номер</td>" +
									"<td>Имя</td> <td>Фамилия</td> <td>Отчество</td>" +
								    "<td>Телефон</td> <td>Коротко о проблеме</td>" +
								    "<td>Сотрудник</td> <td>Статус решения</td>" +
								    "<td>Комментарий сотрудника</td>";
					tblhd.appendChild(trh);
				}
				//body:
				let tblbdPrev = document.getElementById("tblbd");
				tblbdPrev.remove();
				//
				let tblbd = document.createElement("tbody");
				tblbd.setAttribute("id", "tblbd");
				tbl.appendChild(tblbd);
				for (let i = 0; i < received.length; i++)
				{
					let trb = document.createElement("tr");
					trb.innerHTML += "<td>" + received[i].num + "</td>";
					trb.innerHTML += "<td>" + received[i].fUserName + "</td>";
					trb.innerHTML += "<td>" + received[i].sUserName + "</td>";
					trb.innerHTML += "<td>" + received[i].tUserName + "</td>";
					trb.innerHTML += "<td>" + received[i].phone + "</td>";
					trb.innerHTML += "<td>" + received[i].issue + "</td>";
					trb.innerHTML += "<td>" + received[i].employee + "</td>";
					trb.innerHTML += "<td>" + received[i].status + "</td>";
					trb.innerHTML += "<td>" + received[i].comment + "</td>";
					tblbd.appendChild(trb);
				}
				//
				let btn = document.getElementById("submitGet");
				btn.setAttribute("value", "Обновить список");
            });
            request.send();
        });
		*/
    </script>
</body>
</html>
